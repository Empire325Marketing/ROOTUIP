<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROOTUIP - Enterprise Container Intelligence Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/assets/css/enterprise-design-system.css" rel="stylesheet">
    <link href="/assets/css/enterprise-enhancements.css" rel="stylesheet">
    <link href="/assets/css/platform-premium.css" rel="stylesheet">
    <link href="/assets/css/realtime-styles.css" rel="stylesheet">
    <link href="/assets/css/mobile-responsive.css" rel="stylesheet">
    <link href="/assets/css/production-polish.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        /* Enterprise Login Page Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--enterprise-gradient-subtle);
            position: relative;
            overflow: hidden;
        }

        .login-bg-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231E40AF' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .login-card {
            background: var(--enterprise-white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-2xl);
            width: 100%;
            max-width: 480px;
            padding: var(--space-12);
            position: relative;
            z-index: 1;
            border: 1px solid var(--enterprise-gray-100);
        }

        .login-logo {
            text-align: center;
            margin-bottom: var(--space-10);
        }

        .login-logo h1 {
            font-size: var(--text-4xl);
            font-weight: var(--font-extrabold);
            margin-bottom: var(--space-2);
            background: var(--enterprise-gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-logo p {
            color: var(--enterprise-gray-900);
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            line-height: 1.4;
        }
        
        .login-value-prop {
            background: var(--enterprise-primary-subtle);
            border-left: 4px solid var(--enterprise-primary);
            padding: var(--space-4);
            margin: var(--space-6) 0;
            border-radius: var(--radius-md);
        }
        
        .login-value-prop h3 {
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            color: var(--enterprise-primary-dark);
            margin-bottom: var(--space-2);
        }
        
        .login-value-prop p {
            color: var(--enterprise-gray-700);
            font-size: var(--text-base);
            margin: 0;
        }

        .login-form {
            margin-top: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--rootuip-gray-700);
        }

        .login-divider {
            text-align: center;
            margin: 2rem 0;
            position: relative;
        }

        .login-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--rootuip-gray-300);
        }

        .login-divider span {
            background: var(--bg-dark);
            padding: 0 1rem;
            position: relative;
            color: var(--rootuip-gray-600);
            font-size: 0.875rem;
        }

        .btn-social {
            width: 100%;
            margin-bottom: 1rem;
            background: var(--bg-dark);
            border: 1px solid var(--rootuip-gray-300);
            color: var(--rootuip-gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .btn-social:hover {
            background: var(--rootuip-gray-50);
            border-color: var(--rootuip-gray-400);
        }

        .btn-social img {
            width: 20px;
            height: 20px;
        }

        /* Main App Layout */
        .app-container {
            display: flex;
            height: 100vh;
            background: var(--rootuip-gray-50);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-dark);
            box-shadow: 1px 0 3px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--rootuip-gray-200);
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--rootuip-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .nav-item {
            display: block;
            padding: 0.75rem 1.5rem;
            color: var(--rootuip-gray-700);
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-item:hover {
            background: var(--rootuip-gray-50);
            color: var(--rootuip-primary);
        }

        .nav-item.active {
            background: rgba(26, 115, 232, 0.1);
            color: var(--rootuip-primary);
            font-weight: 600;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--rootuip-primary);
        }

        .nav-icon {
            width: 20px;
            text-align: center;
        }

        .nav-section {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--rootuip-gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 1rem;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--rootuip-gray-200);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--rootuip-gray-50);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .user-menu:hover {
            background: var(--rootuip-gray-100);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--rootuip-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--rootuip-gray-900);
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--rootuip-gray-600);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar */
        .topbar {
            background: var(--bg-dark);
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--rootuip-gray-600);
            font-size: 0.875rem;
        }

        .breadcrumb a {
            color: var(--rootuip-gray-600);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--rootuip-primary);
        }

        .breadcrumb-separator {
            color: var(--rootuip-gray-400);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .topbar-btn {
            padding: 0.5rem 1rem;
            background: var(--rootuip-gray-100);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .topbar-btn:hover {
            background: var(--rootuip-gray-200);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--rootuip-danger);
            color: white;
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: 999px;
            font-weight: 600;
        }

        /* Page Content */
        .page-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--rootuip-gray-900);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--rootuip-gray-600);
            font-size: 1.125rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .dashboard-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .dashboard-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .dashboard-card-title {
            font-weight: 600;
            color: var(--rootuip-gray-700);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .dashboard-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--rootuip-gray-900);
            margin-bottom: 0.5rem;
        }

        .dashboard-card-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }

        .change-positive {
            color: var(--rootuip-success);
        }

        .change-negative {
            color: var(--rootuip-danger);
        }

        /* Loading State */
        .loading-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--rootuip-gray-50);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--rootuip-gray-200);
            border-top-color: var(--rootuip-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Premium Components */
        .kpi-card {
            background: var(--enterprise-white);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--enterprise-gray-100);
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }

        .kpi-label {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--enterprise-gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .kpi-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
        }

        .kpi-icon.success {
            background: var(--enterprise-success-subtle);
            color: var(--enterprise-success);
        }

        .kpi-icon.warning {
            background: var(--enterprise-warning-subtle);
            color: var(--enterprise-warning);
        }

        .kpi-icon.danger {
            background: var(--enterprise-danger-subtle);
            color: var(--enterprise-danger);
        }

        .kpi-value {
            font-size: var(--text-3xl);
            font-weight: var(--font-black);
            color: var(--enterprise-dark);
            margin-bottom: var(--space-2);
        }

        .kpi-trend {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
        }

        .kpi-trend.positive {
            color: var(--enterprise-success);
        }

        .kpi-trend.negative {
            color: var(--enterprise-danger);
        }

        .kpi-sparkline {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            opacity: 0.1;
        }

        /* Data Tables */
        .data-table-wrapper {
            background: var(--enterprise-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--enterprise-gray-100);
            overflow: hidden;
        }

        .table-header {
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--enterprise-gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--enterprise-dark);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100%;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .desktop-only {
                display: none;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }
    </style>
    <link rel="stylesheet" href="/assets/css/rootuip-dark-theme.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="app-loading" class="app-loading">
        <div class="loading-content">
            <div class="loading-logo">
                <img src="/assets/images/rootuip-logo.svg" alt="ROOTUIP" style="width: 100%; height: 100%;">
            </div>
            <div class="loading-spinner"></div>
            <div class="loading-text">Initializing secure connection...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator">
        <i class="fas fa-wifi-slash mr-2"></i>
        You are currently offline. Some features may be limited.
    </div>

    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    <div id="app">
        <!-- Production Loading Screen -->
        <div id="app-loading" class="app-loading">
            <div class="loading-content">
                <div class="loading-logo">
                    <i class="fas fa-ship fa-3x" style="color: var(--rootuip-primary);"></i>
                </div>
                <div class="loading-spinner"></div>
                <div class="loading-text">Initializing secure connection...</div>
                <div class="loading-progress">
                    <div class="loading-progress-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="loading-container" style="display: none;">
            <div class="loading-spinner"></div>
        </div>

        <!-- Login Page -->
        <div id="login-page" class="login-container" style="display: none;">
            <div class="login-bg-pattern"></div>
            <div class="login-card">
                <div class="login-logo">
                    <h1><i class="fas fa-ship"></i> ROOTUIP</h1>
                    <p>Prevent $14M+ Annual Losses with AI-Powered Ocean Freight Intelligence</p>
                </div>
                
                <div class="login-value-prop">
                    <h3>Join Fortune 500 Leaders Saving Millions</h3>
                    <p>The only platform that predicts detention & demurrage charges 14 days in advance with 94% accuracy</p>
                </div>

                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" placeholder="mjaiii@rootuip.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                    </div>

                    <div class="form-group">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="remember"> 
                            <span class="text-sm">Remember me for 30 days</span>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                        Sign In
                    </button>
                </form>

                <div class="login-divider">
                    <span>OR</span>
                </div>

                <button class="btn btn-social" onclick="handleSSOLogin('microsoft')">
                    <i class="fab fa-microsoft"></i>
                    Continue with Microsoft
                </button>

                <button class="btn btn-social" onclick="handleSSOLogin('google')">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>

                <div class="text-center mt-4">
                    <a href="#" class="text-sm" onclick="showDemoMode()">View Demo</a>
                    <span class="text-gray-400 mx-2">•</span>
                    <a href="#" class="text-sm">Contact Sales</a>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="platform-container" style="display: none;">
            <!-- Premium Sidebar -->
            <aside class="platform-sidebar" id="sidebar">
                <div class="sidebar-header">
                    <a href="#dashboard" class="sidebar-logo">
                        <i class="fas fa-ship"></i>
                        <h1>ROOTUIP</h1>
                    </a>
                </div>

                <nav class="sidebar-nav">
                    <div class="nav-section">Financial Impact</div>
                    <a href="#dashboard" class="nav-item active" data-page="dashboard">
                        <i class="fas fa-dollar-sign nav-icon"></i>
                        <span>Save $14M+ Annually</span>
                    </a>
                    <a href="#tracking" class="nav-item" data-page="tracking">
                        <i class="fas fa-shield-alt nav-icon"></i>
                        <span>Prevent D&D Charges</span>
                    </a>
                    <a href="#analytics" class="nav-item" data-page="analytics">
                        <i class="fas fa-chart-line nav-icon"></i>
                        <span>Financial Analytics</span>
                    </a>

                    <div class="nav-section">Intelligence Tools</div>
                    <a href="#predictions" class="nav-item" data-page="predictions">
                        <i class="fas fa-brain nav-icon"></i>
                        <span>AI Predictions</span>
                    </a>
                    <a href="#risk-matrix" class="nav-item" data-page="risk-matrix">
                        <i class="fas fa-exclamation-triangle nav-icon"></i>
                        <span>Risk Matrix</span>
                        <span class="notification-badge" style="position: absolute; right: 20px;">12</span>
                    </a>
                    <a href="#roi-calculator" class="nav-item" data-page="roi-calculator">
                        <i class="fas fa-calculator nav-icon"></i>
                        <span>ROI Calculator</span>
                    </a>

                    <div class="nav-section">Operations</div>
                    <a href="#documents" class="nav-item" data-page="documents">
                        <i class="fas fa-file-invoice nav-icon"></i>
                        <span>Document AI</span>
                    </a>
                    <a href="#alerts" class="nav-item" data-page="alerts">
                        <i class="fas fa-bell nav-icon"></i>
                        <span>Smart Alerts</span>
                        <span class="notification-badge" style="position: absolute; right: 20px;">3</span>
                    </a>
                    <a href="#reports" class="nav-item" data-page="reports">
                        <i class="fas fa-file-chart-line nav-icon"></i>
                        <span>Executive Reports</span>
                    </a>

                    <div class="nav-section">System</div>
                    <a href="#integrations" class="nav-item" data-page="integrations">
                        <i class="fas fa-link nav-icon"></i>
                        <span>Integrations</span>
                    </a>
                    <a href="#settings" class="nav-item" data-page="settings">
                        <i class="fas fa-cog nav-icon"></i>
                        <span>Settings</span>
                    </a>
                </nav>

                <div class="sidebar-footer">
                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="user-avatar">JD</div>
                        <div class="user-info">
                            <div class="user-name" id="user-name">John Doe</div>
                            <div class="user-role" id="user-role">VP Operations</div>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </aside>

            <!-- Sidebar Overlay for Mobile -->
            <div class="sidebar-overlay" onclick="closeMobileSidebar()"></div>

            <!-- Main Content Area -->
            <main class="platform-main">
                <!-- Premium Header -->
                <header class="platform-header">
                    <div class="header-left">
                        <button class="mobile-menu-toggle" onclick="toggleMobileSidebar()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <nav class="breadcrumb">
                            <a href="#dashboard">ROOTUIP</a>
                            <span class="breadcrumb-separator">/</span>
                            <span id="current-page">Dashboard</span>
                        </nav>
                    </div>

                    <div class="header-right">
                        <div class="header-search">
                            <input type="text" class="search-input" placeholder="Search containers, reports...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        
                        <div class="header-actions">
                            <div class="urgent-alert animate-pulse" style="background: var(--enterprise-danger); color: white; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>$3.2M at Risk</span>
                            </div>
                            
                            <button class="header-btn" title="Notifications">
                                <i class="fas fa-bell"></i>
                                <span class="notification-dot"></span>
                            </button>
                            
                            <button class="header-btn" title="Help">
                                <i class="fas fa-question-circle"></i>
                            </button>
                            
                            <div class="user-menu-trigger">
                                <div class="user-avatar">JD</div>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Content Area -->
                <div class="platform-content" id="page-content">
                    <div class="content-wrapper">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Load Socket.io -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <!-- Chart.js for premium visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Enterprise Dashboard -->
    <script src="/assets/js/enterprise-dashboard.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // Application State
        const AppState = {
            user: null,
            currentPage: 'dashboard',
            socket: null,
            notifications: [],
            theme: localStorage.getItem('theme') || 'light'
        };

        // API Configuration
        const API = {
            base: window.location.origin + '/api',
            auth: window.location.origin + '/auth',
            ws: window.location.origin.replace('http', 'ws')
        };

        // Initialize Application
        async function initApp() {
            try {
                // Check for demo mode
                const urlParams = new URLSearchParams(window.location.search);
                const isDemoMode = urlParams.get('demo') === 'true';
                
                if (isDemoMode) {
                    AppState.demoMode = true;
                    updateLoadingProgress(50, 'Loading demo environment...');
                    showDemoMode();
                    return;
                }
                
                // Update loading progress
                updateLoadingProgress(20, 'Checking authentication...');
                
                // Check authentication status
                const authStatus = await checkAuth();
                
                updateLoadingProgress(50, 'Loading user data...');
                
                if (authStatus.authenticated) {
                    AppState.user = authStatus.user;
                    updateLoadingProgress(70, 'Initializing dashboard...');
                    showMainApp();
                    updateLoadingProgress(90, 'Establishing real-time connection...');
                    initWebSocket();
                    updateLoadingProgress(100, 'Ready!');
                    setTimeout(() => hideLoadingScreen(), 500);
                    loadPage('dashboard');
                } else {
                    updateLoadingProgress(100, 'Ready!');
                    setTimeout(() => hideLoadingScreen(), 500);
                    showLogin();
                }
            } catch (error) {
                console.error('Init error:', error);
                hideLoadingScreen();
                showError('Failed to initialize application. Please refresh the page.');
            }
        }
        
        // Loading screen helpers
        function updateLoadingProgress(percent, text) {
            const progressBar = document.querySelector('.loading-progress-bar');
            const loadingText = document.querySelector('.loading-text');
            if (progressBar) progressBar.style.width = percent + '%';
            if (loadingText) loadingText.textContent = text;
        }
        
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('app-loading');
            if (loadingScreen) {
                loadingScreen.classList.add('fade-out');
                setTimeout(() => loadingScreen.style.display = 'none', 300);
            }
        }

        // Authentication Functions
        async function checkAuth() {
            try {
                const response = await fetch(`${API.auth}/status`, {
                    credentials: 'include'
                });
                return await response.json();
            } catch (error) {
                return { authenticated: false };
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API.auth}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    AppState.user = data.user;
                    showMainApp();
                    initWebSocket();
                    loadPage('dashboard');
                } else {
                    alert('Invalid credentials. Try demo@rootuip.com / demo123');
                }
            } catch (error) {
                console.error('Login error:', error);
                // For demo purposes, allow login
                handleDemoLogin();
            }
        }

        function handleDemoLogin() {
            AppState.user = {
                id: 'demo-user',
                name: 'John Doe',
                email: 'john.doe@fortune500corp.com',
                role: 'Operations Director',
                company: 'Fortune 500 Corp',
                permissions: ['view_all', 'analytics', 'reports', 'admin']
            };
            showMainApp();
            initWebSocket();
            loadPage('dashboard');
        }

        function handleSSOLogin(provider) {
            window.location.href = `${API.auth}/saml/login?provider=${provider}`;
        }

        async function handleLogout() {
            try {
                await fetch(`${API.auth}/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            AppState.user = null;
            if (AppState.socket) {
                AppState.socket.disconnect();
            }
            showLogin();
        }

        // UI State Management
        function showLogin() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            
            // Update user info
            document.getElementById('user-name').textContent = AppState.user.name;
            document.getElementById('user-role').textContent = AppState.user.role;
            document.getElementById('user-avatar').textContent = AppState.user.name.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        function showDemo() {
            handleDemoLogin();
        }

        // WebSocket Connection
        function initWebSocket() {
            AppState.socket = io(API.ws, {
                path: '/socket.io/',
                transports: ['websocket', 'polling']
            });

            AppState.socket.on('connect', () => {
                console.log('WebSocket connected');
                AppState.socket.emit('authenticate', { userId: AppState.user.id });
            });

            AppState.socket.on('notification', (data) => {
                AppState.notifications.push(data);
                updateNotificationBadge();
            });

            AppState.socket.on('container-update', (data) => {
                if (AppState.currentPage === 'tracking') {
                    updateContainerData(data);
                }
            });
        }

        // Page Navigation
        async function loadPage(page) {
            AppState.currentPage = page;
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Update breadcrumb
            document.getElementById('current-page').textContent = 
                page.charAt(0).toUpperCase() + page.slice(1).replace('-', ' ');

            // Load page content
            const content = await getPageContent(page);
            document.getElementById('page-content').innerHTML = content;

            // Initialize page-specific functionality
            initPageFeatures(page);
        }

        async function getPageContent(page) {
            switch(page) {
                case 'dashboard':
                    return getDashboardContent();
                case 'tracking':
                    return getTrackingContent();
                case 'analytics':
                    return getAnalyticsContent();
                case 'roi-calculator':
                    return getROICalculatorContent();
                case 'documents':
                    return getDocumentsContent();
                case 'alerts':
                    return getAlertsContent();
                case 'integrations':
                    return getIntegrationsContent();
                case 'settings':
                    return getSettingsContent();
                default:
                    return '<div>Page not found</div>';
            }
        }

        // Page Content Generators
        function getDashboardContent() {
            // Use enterprise dashboard if available
            if (typeof getEnterpriseDashboardContent !== 'undefined') {
                return getEnterpriseDashboardContent();
            }
            
            // Fallback to basic dashboard
            return `
                <div class="page-header">
                    <h1 class="page-title">Your $14M+ Annual Savings Dashboard</h1>
                    <p class="page-subtitle">Welcome back, ${AppState.user.name} - You're preventing $38K in charges daily</p>
                </div>

                <!-- Trust Badges -->
                <div class="trust-badges mb-6">
                    <div class="trust-badge">
                        <i class="fas fa-shield-alt text-success"></i>
                        <span>SOC 2 Compliant</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-award text-success"></i>
                        <span>$10B+ Processed</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-users text-success"></i>
                        <span>Fortune 500 Trusted</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-check-circle text-success"></i>
                        <span>99.9% Uptime</span>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <span class="dashboard-card-title">Active Containers</span>
                            <i class="fas fa-ship text-primary"></i>
                        </div>
                        <div class="dashboard-card-value">12,543</div>
                        <div class="dashboard-card-change change-positive">
                            <i class="fas fa-arrow-up"></i> 5.2% from last week
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <span class="dashboard-card-title">On-Time Delivery</span>
                            <i class="fas fa-clock text-success"></i>
                        </div>
                        <div class="dashboard-card-value">94.2%</div>
                        <div class="dashboard-card-change change-positive">
                            <i class="fas fa-arrow-up"></i> 2.1% improvement
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <span class="dashboard-card-title">Cost Savings</span>
                            <i class="fas fa-dollar-sign text-success"></i>
                        </div>
                        <div class="dashboard-card-value">$2.1M</div>
                        <div class="dashboard-card-change change-positive">
                            <i class="fas fa-arrow-up"></i> $125K this month
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <span class="dashboard-card-title">D&D Risk Score</span>
                            <i class="fas fa-exclamation-triangle text-warning"></i>
                        </div>
                        <div class="dashboard-card-value">0.23</div>
                        <div class="dashboard-card-change change-negative">
                            <i class="fas fa-arrow-up"></i> 0.05 increase
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                        <div id="activity-feed"></div>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                        <div class="space-y-2">
                            <button class="btn btn-primary" style="width: 100%;" onclick="loadPage('tracking')">
                                <i class="fas fa-dollar-sign mr-2"></i> Start Saving $38K Daily
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;" onclick="loadPage('analytics')">
                                <i class="fas fa-chart-line mr-2"></i> View $3.2M at Risk
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;" onclick="loadPage('roi-calculator')">
                                <i class="fas fa-dollar-sign mr-2"></i> See Your 412% ROI
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getTrackingContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Prevent $50K+ Detention Charges Per Container</h1>
                    <p class="page-subtitle">24/7 AI monitoring predicts delays 14 days in advance with 94% accuracy</p>
                </div>

                <div class="card mb-4">
                    <div class="flex gap-4">
                        <input type="text" class="form-control flex-1" placeholder="Enter container number to prevent costly delays">
                        <button class="btn btn-primary">Start Saving Now</button>
                    </div>
                </div>

                <div class="card">
                    <iframe src="/container-tracking-interface.html" style="width: 100%; height: 600px; border: none; border-radius: 8px;"></iframe>
                </div>
            `;
        }

        function getAnalyticsContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Turn Your $100M+ Shipping Data Into Savings</h1>
                    <p class="page-subtitle">Executive dashboards that identify cost reduction opportunities worth millions</p>
                </div>

                <div class="card">
                    <iframe src="/performance-dashboard.html" style="width: 100%; height: 800px; border: none; border-radius: 8px;"></iframe>
                </div>
            `;
        }

        function getROICalculatorContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">See Your $25M+ Annual Savings Potential</h1>
                    <p class="page-subtitle">Calculate your exact ROI based on your shipping volume - average 412% return in 90 days</p>
                </div>

                <div class="card">
                    <iframe src="/fortune-500-roi-calculator.html" style="width: 100%; height: 900px; border: none; border-radius: 8px;"></iframe>
                </div>
            `;
        }

        function getDocumentsContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Eliminate 67% of Manual Processing Work</h1>
                    <p class="page-subtitle">AI processes BOLs, invoices, and customs docs with 99.9% accuracy</p>
                </div>

                <div class="card">
                    <div class="text-center py-8">
                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Start Saving 15 Hours Per Week</h3>
                        <p class="text-gray-600 mb-4">Our AI processes documents 50x faster than manual entry</p>
                        <button class="btn btn-primary">Automate Now</button>
                    </div>
                </div>
            `;
        }

        function getAlertsContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Prevent Million-Dollar Surprises</h1>
                    <p class="page-subtitle">Get alerts 14 days before costly delays - never pay another late fee</p>
                </div>

                <div class="card">
                    <div class="space-y-4">
                        ${AppState.notifications.map(n => `
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                <i class="fas fa-exclamation-circle text-warning text-xl"></i>
                                <div class="flex-1">
                                    <h4 class="font-semibold">${n.title || 'Container Delay Alert'}</h4>
                                    <p class="text-sm text-gray-600">${n.message || 'Container MSKU1234567 delayed at Port of LA'}</p>
                                </div>
                                <span class="text-sm text-gray-500">${n.time || '5 mins ago'}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getIntegrationsContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Connect All Major Carriers in Minutes</h1>
                    <p class="page-subtitle">Instant integration with Maersk, MSC, CMA CGM, and 47+ carriers</p>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="flex items-center gap-4 mb-4">
                            <img src="https://www.maersk.com/~/media/ml/press/brand-assets/logos/maersk-logo.png" alt="Maersk" style="height: 40px;">
                            <div class="flex-1">
                                <h3 class="font-semibold">Maersk</h3>
                                <p class="text-sm text-gray-600">Live tracking enabled</p>
                            </div>
                            <span class="badge badge-success">Connected</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-10 h-10 bg-gray-200 rounded flex items-center justify-center">
                                <i class="fas fa-ship"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold">MSC</h3>
                                <p class="text-sm text-gray-600">Click to connect</p>
                            </div>
                            <button class="btn btn-primary btn-sm">Connect Now</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getSettingsContent() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Manage your account and preferences</p>
                </div>

                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">Account Settings</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" value="${AppState.user.name}">
                        </div>
                        <div>
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" value="${AppState.user.email}">
                        </div>
                        <div>
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" value="${AppState.user.company}">
                        </div>
                        <button class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            `;
        }

        // Page-specific initialization
        function initPageFeatures(page) {
            switch(page) {
                case 'dashboard':
                    loadActivityFeed();
                    startDashboardUpdates();
                    // Initialize premium charts if available
                    if (typeof initializePremiumCharts !== 'undefined') {
                        setTimeout(initializePremiumCharts, 100);
                    }
                    break;
                case 'tracking':
                    // Container tracking is handled by iframe
                    break;
                case 'analytics':
                    // Analytics is handled by iframe
                    break;
            }
        }

        async function loadActivityFeed() {
            try {
                const response = await fetch(`${API.base}/activity/recent`);
                const activities = await response.json();
                
                const feedHtml = activities.map(a => `
                    <div class="flex gap-3 mb-3">
                        <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-${a.icon || 'info'} text-primary text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">${a.message}</p>
                            <p class="text-xs text-gray-500">${a.time}</p>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('activity-feed').innerHTML = feedHtml;
            } catch (error) {
                console.error('Failed to load activity feed:', error);
                // Show mock data for demo
                document.getElementById('activity-feed').innerHTML = `
                    <div class="flex gap-3 mb-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-ship text-blue-600 text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">Container MSKU1234567 arrived at Port of LA</p>
                            <p class="text-xs text-gray-500">5 minutes ago</p>
                        </div>
                    </div>
                    <div class="flex gap-3 mb-3">
                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-check text-green-600 text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">Documentation verified for shipment #2024-1543</p>
                            <p class="text-xs text-gray-500">15 minutes ago</p>
                        </div>
                    </div>
                `;
            }
        }

        function startDashboardUpdates() {
            // Update dashboard metrics every 30 seconds
            setInterval(() => {
                if (AppState.currentPage === 'dashboard') {
                    updateDashboardMetrics();
                }
            }, 30000);
        }

        function updateDashboardMetrics() {
            // Simulate real-time updates
            const activeContainers = document.querySelector('.dashboard-card-value');
            if (activeContainers) {
                const current = parseInt(activeContainers.textContent.replace(',', ''));
                const change = Math.floor(Math.random() * 20) - 10;
                activeContainers.textContent = (current + change).toLocaleString();
            }
        }

        // UI Helpers
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            sidebar.classList.toggle('mobile-open');
            
            // Create overlay if it doesn't exist
            if (!overlay) {
                const newOverlay = document.createElement('div');
                newOverlay.id = 'mobile-overlay';
                newOverlay.className = 'mobile-sidebar-overlay';
                newOverlay.onclick = toggleMobileMenu;
                document.body.appendChild(newOverlay);
            }
            
            // Toggle overlay visibility
            const existingOverlay = document.getElementById('mobile-overlay');
            if (sidebar.classList.contains('mobile-open')) {
                existingOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                existingOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function toggleUserMenu() {
            if (confirm('Sign out of ROOTUIP?')) {
                handleLogout();
            }
        }

        function showNotifications() {
            alert(`You have ${AppState.notifications.length} new notifications`);
        }

        function showSearch() {
            const query = prompt('Search containers, documents, or carriers:');
            if (query) {
                alert(`Searching for: ${query}`);
            }
        }

        function toggleTheme() {
            AppState.theme = AppState.theme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', AppState.theme);
            document.body.classList.toggle('dark-theme');
        }
        
        // Error Handling and User Feedback
        function showError(message, title = 'Error', details = null) {
            const errorContainer = document.createElement('div');
            errorContainer.className = 'error-toast';
            errorContainer.innerHTML = `
                <div class="error-toast-content">
                    <div class="error-toast-header">
                        <i class="fas fa-exclamation-circle text-danger"></i>
                        <strong>${title}</strong>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="close-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="error-toast-body">
                        <p>${message}</p>
                        ${details ? `<details><summary>Technical Details</summary><pre>${details}</pre></details>` : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(errorContainer);
            
            // Auto-remove after 10 seconds
            setTimeout(() => errorContainer.remove(), 10000);
        }
        
        function showSuccess(message, title = 'Success') {
            const successContainer = document.createElement('div');
            successContainer.className = 'success-toast';
            successContainer.innerHTML = `
                <div class="success-toast-content">
                    <i class="fas fa-check-circle text-success"></i>
                    <div>
                        <strong>${title}</strong>
                        <p>${message}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(successContainer);
            
            // Auto-remove after 5 seconds
            setTimeout(() => successContainer.remove(), 5000);
        }
        
        function showWarning(message, title = 'Warning') {
            const warningContainer = document.createElement('div');
            warningContainer.className = 'warning-toast';
            warningContainer.innerHTML = `
                <div class="warning-toast-content">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    <div>
                        <strong>${title}</strong>
                        <p>${message}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(warningContainer);
            
            // Auto-remove after 7 seconds
            setTimeout(() => warningContainer.remove(), 7000);
        }
        
        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showError('An unexpected error occurred. Our team has been notified.', 'System Error');
        });
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled rejection:', event.reason);
            showError('A connection error occurred. Please check your internet connection.', 'Connection Error');
        });
        
        // Network status monitoring
        window.addEventListener('online', () => {
            const offlineIndicator = document.getElementById('offline-indicator');
            if (offlineIndicator) {
                offlineIndicator.classList.remove('show');
            }
            showSuccess('Connection restored', 'Back Online');
        });
        
        window.addEventListener('offline', () => {
            const offlineIndicator = document.getElementById('offline-indicator');
            if (offlineIndicator) {
                offlineIndicator.classList.add('show');
            }
            showWarning('You are currently offline. Some features may be limited.', 'Offline Mode');
        });

        function updateNotificationBadge() {
            document.querySelectorAll('.notification-badge').forEach(badge => {
                badge.textContent = AppState.notifications.length;
            });
        }

        // Event Listeners
        document.getElementById('login-form').addEventListener('submit', handleLogin);

        // Handle navigation clicks
        document.addEventListener('click', (e) => {
            if (e.target.matches('.nav-item') || e.target.closest('.nav-item')) {
                e.preventDefault();
                const item = e.target.closest('.nav-item');
                const page = item.dataset.page;
                if (page) {
                    loadPage(page);
                    window.location.hash = page;
                }
            }
        });

        // Handle browser back/forward
        window.addEventListener('popstate', () => {
            const page = window.location.hash.slice(1) || 'dashboard';
            loadPage(page);
        });

        // Mock some notifications for demo
        AppState.notifications = [
            { title: '$487K at Risk', message: 'MSKU1234567 will incur detention charges in 7 days - take action now', time: '5 mins ago' },
            { title: '$12K Saved', message: 'Document processing prevented late fees on BOL #2024-1543', time: '15 mins ago' },
            { title: '$1.2M Risk Alert', message: '3 containers require immediate action to prevent D&D charges', time: '1 hour ago' }
        ];

        // Initialize app on load
        initApp();
    </script>

    <!-- Performance utilities -->
    <script src="/assets/js/performance-utils.js"></script>
    
    <!-- Real-time client -->
    <script src="/assets/js/realtime-client.js"></script>
    <script>
        // Initialize real-time client
        let realtimeClient = null;
        
        function initializeRealTime() {
            if (!AppState.user || !AppState.token) return;
            
            // Create real-time client
            realtimeClient = new RootUIRealTimeClient({
                url: window.location.origin,
                debug: true
            });
            
            // Setup event handlers
            setupRealtimeHandlers();
            
            // Connect with auth token
            realtimeClient.connect(AppState.token)
                .then(() => {
                    console.log('Real-time connection established');
                    showRealtimeIndicator('connected');
                    
                    // Subscribe to relevant rooms based on user role
                    subscribeToRooms();
                })
                .catch(error => {
                    console.error('Real-time connection failed:', error);
                    showRealtimeIndicator('disconnected');
                });
        }
        
        function setupRealtimeHandlers() {
            // Container updates
            realtimeClient.on('container:update', (data) => {
                console.log('Container update:', data);
                updateContainerInUI(data);
            });
            
            // Risk updates
            realtimeClient.on('risk:update', (data) => {
                console.log('Risk update:', data);
                updateRiskIndicator(data);
            });
            
            // Alerts
            realtimeClient.on('alert:critical', (data) => {
                showNotification('Critical Alert', data.message, 'error');
            });
            
            realtimeClient.on('alert:warning', (data) => {
                showNotification('Warning', data.message, 'warning');
            });
            
            // Metrics updates
            realtimeClient.on('metrics:update', (data) => {
                updateDashboardMetrics(data);
            });
            
            // Connection events
            realtimeClient.on('connection:lost', () => {
                showRealtimeIndicator('disconnected');
            });
            
            realtimeClient.on('connection:error', () => {
                showRealtimeIndicator('error');
            });
        }
        
        function subscribeToRooms() {
            const role = AppState.user.role;
            
            // Subscribe to role-based updates
            realtimeClient.subscribe(`role:${role}`);
            
            // Subscribe to dashboards
            realtimeClient.subscribe('dashboard:operations');
            
            if (role === 'executive' || role === 'admin') {
                realtimeClient.subscribe('dashboard:executive');
                realtimeClient.subscribe('alerts:critical');
            }
            
            // Subscribe to general updates
            realtimeClient.subscribe(['metrics:live', 'alerts:all']);
        }
        
        function showRealtimeIndicator(status) {
            let indicator = document.getElementById('realtime-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'realtime-indicator';
                indicator.className = 'realtime-indicator';
                indicator.innerHTML = `
                    <span class="realtime-status-dot"></span>
                    <span class="realtime-status-text">Real-time</span>
                `;
                document.body.appendChild(indicator);
            }
            
            indicator.className = `realtime-indicator ${status}`;
            const dot = indicator.querySelector('.realtime-status-dot');
            dot.className = `realtime-status-dot ${status}`;
            
            const text = indicator.querySelector('.realtime-status-text');
            const statusTexts = {
                connected: 'Live',
                disconnected: 'Offline',
                connecting: 'Connecting...',
                error: 'Connection Error'
            };
            text.textContent = statusTexts[status] || 'Unknown';
        }
        
        function updateContainerInUI(data) {
            // Update container in tracking page if visible
            if (AppState.currentPage === 'tracking') {
                const containerEl = document.querySelector(`[data-container="${data.containerNumber}"]`);
                if (containerEl) {
                    // Add update animation
                    containerEl.classList.add('updated');
                    setTimeout(() => containerEl.classList.remove('updated'), 1000);
                }
            }
            
            // Update dashboard if visible
            if (AppState.currentPage === 'dashboard') {
                updateDashboardContainer(data);
            }
        }
        
        function updateDashboardMetrics(data) {
            if (AppState.currentPage !== 'dashboard') return;
            
            // Update metric cards
            Object.entries(data.metrics || {}).forEach(([key, value]) => {
                const metricEl = document.querySelector(`[data-metric="${key}"]`);
                if (metricEl) {
                    metricEl.textContent = formatMetricValue(value);
                    metricEl.classList.add('metric-updated');
                    setTimeout(() => metricEl.classList.remove('metric-updated'), 500);
                }
            });
        }
        
        function formatMetricValue(value) {
            if (typeof value === 'number') {
                if (value > 1000000) {
                    return `${(value / 1000000).toFixed(1)}M`;
                } else if (value > 1000) {
                    return `${(value / 1000).toFixed(1)}K`;
                }
                return value.toLocaleString();
            }
            return value;
        }
        
        // Demo Mode Functions
        function showDemoMode() {
            AppState.demoMode = true;
            AppState.user = {
                id: 'demo-user',
                email: 'demo@rootuip.com',
                name: 'Demo User',
                role: 'Operations Director',
                company: 'Fortune 500 Demo Company'
            };
            
            // Show demo banner
            const demoBanner = document.createElement('div');
            demoBanner.className = 'demo-mode-banner';
            demoBanner.innerHTML = `
                <i class="fas fa-info-circle"></i>
                <span>Demo Mode - Explore all features with sample data</span>
                <button onclick="exitDemoMode()" class="btn btn-sm btn-secondary ml-auto">
                    Exit Demo
                </button>
            `;
            document.body.appendChild(demoBanner);
            
            updateLoadingProgress(100, 'Demo ready!');
            setTimeout(() => hideLoadingScreen(), 500);
            showMainApp();
            loadPage('dashboard');
            
            // Start demo data generation
            startDemoDataGeneration();
        }
        
        function exitDemoMode() {
            AppState.demoMode = false;
            window.location.href = window.location.pathname;
        }
        
        function startDemoDataGeneration() {
            // Generate demo containers
            AppState.demoContainers = generateDemoContainers(50);
            
            // Simulate real-time updates
            setInterval(() => {
                if (AppState.demoMode && AppState.currentPage === 'dashboard') {
                    updateDemoMetrics();
                }
            }, 5000);
            
            // Simulate notifications
            setInterval(() => {
                if (AppState.demoMode) {
                    generateDemoNotification();
                }
            }, 30000);
        }
        
        function generateDemoContainers(count) {
            const containers = [];
            const statuses = ['in_transit', 'at_port', 'delayed', 'delivered', 'customs_hold'];
            const carriers = ['Maersk', 'MSC', 'CMA CGM', 'Hapag-Lloyd', 'ONE'];
            const routes = [
                { from: 'Shanghai', to: 'Los Angeles' },
                { from: 'Singapore', to: 'Rotterdam' },
                { from: 'Hong Kong', to: 'Hamburg' },
                { from: 'Shenzhen', to: 'New York' },
                { from: 'Busan', to: 'Long Beach' }
            ];
            
            for (let i = 0; i < count; i++) {
                const route = routes[Math.floor(Math.random() * routes.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                
                containers.push({
                    containerNumber: `DEMO${String(i + 1).padStart(7, '0')}`,
                    status,
                    carrier: carriers[Math.floor(Math.random() * carriers.length)],
                    origin: route.from,
                    destination: route.to,
                    eta: new Date(Date.now() + Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    riskScore: Math.random() * 0.5,
                    value: Math.floor(Math.random() * 500000) + 50000
                });
            }
            
            return containers;
        }
        
        function updateDemoMetrics() {
            const metrics = {
                containers_tracked: AppState.demoContainers.length,
                on_time_delivery: Math.floor(Math.random() * 10 + 85),
                revenue_at_risk: Math.floor(Math.random() * 5000000 + 1000000),
                dd_risk_score: (Math.random() * 0.3 + 0.1).toFixed(2)
            };
            
            // Simulate metric updates
            Object.entries(metrics).forEach(([key, value]) => {
                const el = document.querySelector(`[data-metric="${key}"]`);
                if (el) {
                    el.textContent = formatMetricValue(value);
                    el.classList.add('metric-updated');
                    setTimeout(() => el.classList.remove('metric-updated'), 500);
                }
            });
        }
        
        function generateDemoNotification() {
            const notifications = [
                { title: 'Container Delayed', message: 'DEMO0001234 delayed at Port of LA', type: 'warning' },
                { title: 'Risk Alert', message: 'High D&D risk detected for 3 containers', type: 'danger' },
                { title: 'Document Processed', message: 'Bill of Lading processed successfully', type: 'success' },
                { title: 'ETA Updated', message: 'DEMO0005678 new ETA: Dec 25', type: 'info' }
            ];
            
            const notification = notifications[Math.floor(Math.random() * notifications.length)];
            AppState.notifications.push(notification);
            updateNotificationBadge();
            
            if (notification.type === 'danger') {
                showError(notification.message, notification.title);
            } else if (notification.type === 'warning') {
                showWarning(notification.message, notification.title);
            } else {
                showSuccess(notification.message, notification.title);
            }
        }
        
        // Initialize real-time when app loads
        document.addEventListener('DOMContentLoaded', () => {
            if (AppState.isAuthenticated && !AppState.demoMode) {
                setTimeout(initializeRealTime, 1000);
            }
        });
        
        // Cleanup on logout
        window.addEventListener('beforeunload', () => {
            if (realtimeClient) {
                realtimeClient.disconnect();
            }
        });
        
        // Browser compatibility check
        function checkBrowserCompatibility() {
            const features = {
                'WebSocket': 'WebSocket' in window,
                'LocalStorage': (() => {
                    try {
                        localStorage.setItem('test', 'test');
                        localStorage.removeItem('test');
                        return true;
                    } catch(e) {
                        return false;
                    }
                })(),
                'Fetch API': 'fetch' in window,
                'Promises': 'Promise' in window,
                'CSS Grid': CSS.supports('display', 'grid'),
                'CSS Variables': CSS.supports('--test', 'test')
            };
            
            const unsupported = Object.entries(features)
                .filter(([feature, supported]) => !supported)
                .map(([feature]) => feature);
            
            if (unsupported.length > 0) {
                showWarning(
                    `Your browser may not support: ${unsupported.join(', ')}. ` +
                    'For the best experience, please use the latest version of Chrome, Firefox, Safari, or Edge.',
                    'Browser Compatibility'
                );
            }
            
            // Add browser class for specific fixes
            const ua = navigator.userAgent;
            if (ua.includes('Firefox')) {
                document.documentElement.classList.add('firefox');
            } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                document.documentElement.classList.add('safari');
            } else if (ua.includes('Edge')) {
                document.documentElement.classList.add('edge');
            }
        }
    </script>
    
    <!-- Production Polish Scripts -->
    <script>
        // Initialize performance optimizations
        document.addEventListener('DOMContentLoaded', () => {
            // Check browser compatibility
            checkBrowserCompatibility();
            
            // Initialize performance utilities
            if (typeof PerformanceUtils !== 'undefined') {
                PerformanceUtils.init();
            }
            
            // Hide loading screen with animation
            setTimeout(() => {
                const loadingScreen = document.getElementById('app-loading');
                if (loadingScreen) {
                    loadingScreen.classList.add('fade-out');
                    setTimeout(() => loadingScreen.remove(), 300);
                }
            }, 1500);
            
            // Animate loading progress
            const progressBar = document.getElementById('loading-progress');
            if (progressBar) {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 30;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    progressBar.style.width = progress + '%';
                }, 200);
            }
            
            // Mobile menu functionality
            const mobileMenuToggle = document.createElement('button');
            mobileMenuToggle.className = 'mobile-menu-toggle hide-desktop';
            mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
            mobileMenuToggle.style.display = 'none';
            
            // Add mobile menu toggle to header
            const header = document.querySelector('.app-header');
            if (header && window.innerWidth <= 1023) {
                header.appendChild(mobileMenuToggle);
                mobileMenuToggle.style.display = 'flex';
                
                mobileMenuToggle.addEventListener('click', () => {
                    const sidebar = document.querySelector('.app-sidebar');
                    const overlay = document.createElement('div');
                    overlay.className = 'mobile-sidebar-overlay';
                    
                    if (sidebar.classList.contains('mobile-open')) {
                        sidebar.classList.remove('mobile-open');
                        document.querySelector('.mobile-sidebar-overlay')?.remove();
                    } else {
                        sidebar.classList.add('mobile-open');
                        document.body.appendChild(overlay);
                        overlay.classList.add('active');
                        
                        overlay.addEventListener('click', () => {
                            sidebar.classList.remove('mobile-open');
                            overlay.remove();
                        });
                    }
                });
            }
            
            // Offline detection
            function updateOnlineStatus() {
                const indicator = document.getElementById('offline-indicator');
                if (!navigator.onLine) {
                    indicator.classList.add('show');
                    showNotification('Connection Lost', 'You are now working offline', 'warning');
                } else {
                    indicator.classList.remove('show');
                    if (indicator.classList.contains('was-offline')) {
                        showNotification('Connection Restored', 'You are back online', 'success');
                    }
                }
                indicator.classList.add('was-offline');
            }
            
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Add demo mode banner for demos
            if (window.location.search.includes('demo=true')) {
                const demoBanner = document.createElement('div');
                demoBanner.className = 'demo-mode-banner';
                demoBanner.innerHTML = `
                    <i class="fas fa-info-circle"></i>
                    <span>Demo Mode - Using simulated data</span>
                `;
                document.body.appendChild(demoBanner);
            }
            
            // Error boundary for production
            window.addEventListener('error', (event) => {
                console.error('Global error:', event.error);
                
                // Show user-friendly error message
                if (!event.error?.stack?.includes('development')) {
                    showNotification(
                        'Something went wrong',
                        'We encountered an error. Please refresh the page.',
                        'error'
                    );
                }
            });
            
            // Add touch feedback for mobile
            if ('ontouchstart' in window) {
                document.addEventListener('touchstart', (e) => {
                    const target = e.target.closest('.btn, .nav-link, .clickable');
                    if (target) {
                        target.style.transform = 'scale(0.98)';
                    }
                });
                
                document.addEventListener('touchend', (e) => {
                    const target = e.target.closest('.btn, .nav-link, .clickable');
                    if (target) {
                        target.style.transform = '';
                    }
                });
            }
            
            // Accessibility improvements
            // Add ARIA live region for announcements
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.setAttribute('aria-atomic', 'true');
            liveRegion.className = 'sr-only';
            liveRegion.id = 'live-region';
            document.body.appendChild(liveRegion);
            
            // Focus management for modals
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.show');
                    if (activeModal) {
                        // Close modal
                        activeModal.classList.remove('show');
                    }
                }
            });
            
            // Add professional animations on scroll
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const animationObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, observerOptions);
            
            // Observe elements for animation
            document.querySelectorAll('.card, .dashboard-card').forEach(el => {
                el.classList.add('fade-in');
                animationObserver.observe(el);
            });
        });
        
        // Browser compatibility check
        (function checkCompatibility() {
            const features = {
                'CSS Grid': CSS.supports('display', 'grid'),
                'Flexbox': CSS.supports('display', 'flex'),
                'Custom Properties': CSS.supports('--test', '0'),
                'Fetch API': 'fetch' in window,
                'LocalStorage': 'localStorage' in window
            };
            
            const unsupported = Object.entries(features)
                .filter(([_, supported]) => !supported)
                .map(([feature]) => feature);
            
            if (unsupported.length > 0) {
                console.warn('Browser missing features:', unsupported);
                
                // Show compatibility warning
                const warning = document.createElement('div');
                warning.className = 'browser-warning';
                warning.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    Your browser may not support all features. Please update to the latest version.
                `;
                warning.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #f59e0b;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 9999;
                `;
                document.body.appendChild(warning);
                
                setTimeout(() => warning.remove(), 10000);
            }
        })();
    </script>
</body>
</html>