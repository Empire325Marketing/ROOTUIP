class PresentationExporter{constructor(){this.presentation=null,this.slides=[]}init(){this.attachEventListeners()}attachEventListeners(){const e=document.querySelector(".export-btn");e&&e.addEventListener("click",()=>this.showExportModal());document.querySelectorAll(".export-option").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.format;this.exportPresentation(t)})});const t=document.getElementById("closeExportModal");t&&t.addEventListener("click",()=>this.hideExportModal())}showExportModal(){const e=document.getElementById("exportModal");e&&e.classList.add("active")}hideExportModal(){const e=document.getElementById("exportModal");e&&e.classList.remove("active")}async exportPresentation(e){switch(this.gatherPresentationData(),e){case"pdf":await this.exportToPDF();break;case"pptx":await this.exportToPowerPoint();break;case"link":await this.generateShareLink();break;default:console.error("Unknown export format:",e)}this.hideExportModal()}gatherPresentationData(){const e=document.querySelectorAll(".slide");this.slides=Array.from(e).map((e,t)=>({number:t+1,content:e.innerHTML,notes:e.dataset.notes||"",title:this.extractSlideTitle(e)})),this.presentation={title:document.querySelector(".presentation-title")?.textContent||"UIP Presentation",company:localStorage.getItem("prospectName")||"Your Company",vesselCount:localStorage.getItem("vesselCount")||"50",date:(new Date).toLocaleDateString(),slideCount:this.slides.length}}extractSlideTitle(e){const t=e.querySelector(".slide-title, h1, h2");return t?t.textContent.trim():`Slide ${e.dataset.slide}`}async exportToPDF(){const e=document.createElement("style");e.textContent="\n            @media print {\n                body { background: white; }\n                .viewer-topbar,\n                .navigation-controls,\n                .slide-navigator,\n                .presenter-notes { display: none !important; }\n                \n                .slide {\n                    page-break-after: always;\n                    position: static !important;\n                    opacity: 1 !important;\n                    transform: none !important;\n                    width: 100% !important;\n                    height: 100vh !important;\n                    display: flex !important;\n                    margin: 0 !important;\n                }\n                \n                .slide-content {\n                    max-width: 100% !important;\n                    padding: 2rem !important;\n                }\n                \n                /* Add slide numbers */\n                .slide::after {\n                    content: attr(data-slide);\n                    position: fixed;\n                    bottom: 1rem;\n                    right: 1rem;\n                    font-size: 0.875rem;\n                    color: #666;\n                }\n            }\n        ",document.head.appendChild(e),window.print(),setTimeout(()=>{document.head.removeChild(e)},1e3),this.showExportSuccess("PDF export ready. Use your browser's print dialog to save as PDF.")}async exportToPowerPoint(){const e={metadata:this.presentation,slides:this.slides.map(e=>({number:e.number,title:e.title,content:this.convertHTMLToText(e.content),notes:e.notes,layout:this.detectSlideLayout(e.content)}))},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`${this.presentation.title.replace(/\s+/g,"-")}-export.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o),this.showExportSuccess("PowerPoint export data downloaded. Use a converter tool to create PPTX.")}async generateShareLink(){const e=new URLSearchParams({presentation:"master",company:this.presentation.company,vessels:this.presentation.vesselCount,industry:localStorage.getItem("industryType")||"general"}),t=`${window.location.origin}/presentation-deck.html?${e.toString()}`;try{await navigator.clipboard.writeText(t),this.showExportSuccess("Share link copied to clipboard!")}catch(e){const n=document.createElement("input");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),this.showExportSuccess("Share link copied to clipboard!")}this.showShareLink(t)}convertHTMLToText(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}detectSlideLayout(e){return e.includes("slide-title")&&e.includes("chart")?"title-chart":e.includes("comparison-table")?"comparison":e.includes("timeline")?"timeline":e.includes("title-slide")?"title":"content"}showExportSuccess(e){const t=document.createElement("div");t.className="export-notification success",t.innerHTML=`\n            <div class="notification-content">\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">\n                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n                </svg>\n                <span>${e}</span>\n            </div>\n        `;if(!document.getElementById("export-notification-styles")){const e=document.createElement("style");e.id="export-notification-styles",e.textContent="\n            .export-notification {\n                position: fixed;\n                bottom: 2rem;\n                left: 50%;\n                transform: translateX(-50%);\n                background: #00D4AA;\n                color: white;\n                padding: 1rem 2rem;\n                border-radius: 8px;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n                z-index: 1001;\n                animation: slideUp 0.3s ease;\n            }\n            \n            .notification-content {\n                display: flex;\n                align-items: center;\n                gap: 0.75rem;\n            }\n            \n            @keyframes slideUp {\n                from {\n                    opacity: 0;\n                    transform: translate(-50%, 20px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translate(-50%, 0);\n                }\n            }\n        ",document.head.appendChild(e)}document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideUp 0.3s ease reverse",setTimeout(()=>{document.body.removeChild(t)},300)},3e3)}showShareLink(e){const t=document.createElement("div");t.className="share-link-modal",t.innerHTML=`\n            <div class="share-content">\n                <h3>Share This Presentation</h3>\n                <p>Send this link to share your customized presentation:</p>\n                <div class="share-url-container">\n                    <input type="text" value="${e}" readonly class="share-url-input">\n                    <button class="copy-btn" onclick="navigator.clipboard.writeText('${e}')">\n                        Copy\n                    </button>\n                </div>\n                <button class="close-share-modal">Close</button>\n            </div>\n        `;if(!document.getElementById("share-modal-styles")){const e=document.createElement("style");e.id="share-modal-styles",e.textContent="\n            .share-link-modal {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: white;\n                padding: 2rem;\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n                z-index: 1002;\n                max-width: 500px;\n                width: 90%;\n            }\n            \n            .share-content h3 {\n                margin-bottom: 1rem;\n                color: #0A1628;\n            }\n            \n            .share-content p {\n                color: #64748B;\n                margin-bottom: 1.5rem;\n            }\n            \n            .share-url-container {\n                display: flex;\n                gap: 0.5rem;\n                margin-bottom: 1.5rem;\n            }\n            \n            .share-url-input {\n                flex: 1;\n                padding: 0.75rem;\n                border: 2px solid #E2E8F0;\n                border-radius: 6px;\n                font-family: 'IBM Plex Mono', monospace;\n                font-size: 0.875rem;\n            }\n            \n            .copy-btn {\n                padding: 0.75rem 1.5rem;\n                background: #00D4AA;\n                color: white;\n                border: none;\n                border-radius: 6px;\n                font-weight: 600;\n                cursor: pointer;\n            }\n            \n            .close-share-modal {\n                width: 100%;\n                padding: 0.75rem;\n                background: #E2E8F0;\n                border: none;\n                border-radius: 6px;\n                font-weight: 600;\n                cursor: pointer;\n            }\n        ",document.head.appendChild(e)}document.body.appendChild(t),t.querySelector(".close-share-modal").addEventListener("click",()=>{document.body.removeChild(t)})}}document.addEventListener("DOMContentLoaded",()=>{(new PresentationExporter).init()});