class PresentationSuite{constructor(){this.currentAudience=null,this.currentPresentation=null,this.customData={},this.currentSlideIndex=0,this.timerStart=null,this.timerInterval=null,this.isFullscreen=!1,this.init()}init(){this.setupEventListeners(),this.loadSavedData(),anime({targets:".presentation-hub",opacity:[0,1],translateY:[30,0],duration:800,easing:"easeOutCubic"})}setupEventListeners(){document.querySelectorAll(".audience-card").forEach(e=>{e.addEventListener("click",t=>{this.selectAudience(e.dataset.audience)})}),document.getElementById("companyName").addEventListener("input",e=>{this.customData.companyName=e.target.value,this.saveCustomData()}),document.getElementById("vesselCount").addEventListener("input",e=>{this.customData.vesselCount=parseInt(e.target.value)||50,this.updateROICalculations(),this.saveCustomData()}),document.getElementById("industryType").addEventListener("change",e=>{this.customData.industryType=e.target.value,this.saveCustomData()}),document.getElementById("annualRevenue").addEventListener("input",e=>{this.customData.annualRevenue=e.target.value,this.saveCustomData()}),document.getElementById("meetingDuration").addEventListener("change",e=>{this.customData.meetingDuration=parseInt(e.target.value),this.saveCustomData()}),document.getElementById("presenterName").addEventListener("input",e=>{this.customData.presenterName=e.target.value,this.saveCustomData()}),document.getElementById("startPresentation").addEventListener("click",()=>{this.startPresentation()}),document.getElementById("previewSlides").addEventListener("click",()=>{this.previewSlides()}),document.getElementById("downloadPDF").addEventListener("click",()=>{this.downloadPDF()}),document.getElementById("backToHub").addEventListener("click",()=>{this.backToHub()}),document.getElementById("toggleNotes").addEventListener("click",()=>{this.toggleNotes()}),document.getElementById("toggleFullscreen").addEventListener("click",()=>{this.toggleFullscreen()}),document.addEventListener("keydown",e=>{this.handleKeyboard(e)}),window.addEventListener("resize",()=>{this.currentPresentation&&this.resizePresentation()})}selectAudience(e){document.querySelectorAll(".audience-card").forEach(e=>{e.classList.remove("selected")});const t=document.querySelector(`[data-audience="${e}"]`);t.classList.add("selected"),this.currentAudience=e,anime({targets:t,scale:[1,1.05,1],duration:300,easing:"easeInOutCubic"}),document.getElementById("startPresentation").disabled=!1,this.updatePresentationPreview()}updatePresentationPreview(){if(!this.currentAudience||!window.presentationData)return;const e=window.presentationData.templates[this.currentAudience];e&&(document.querySelector(".current-slide").textContent="1",document.querySelector(".total-slides").textContent=e.slides.length,document.getElementById("currentTitle").textContent=e.title)}updateROICalculations(){const e=this.customData.vesselCount||50,t=14*e,n=.5*e,a=(t/n).toFixed(1),s=Math.round(n/t*365);this.customData.annualSavings=t,this.customData.totalInvestment=n,this.customData.roiMultiple=a,this.customData.paybackDays=s}startPresentation(){this.currentAudience?(document.getElementById("presentationHub").style.display="none",document.getElementById("presentationViewer").style.display="block",this.loadPresentation(),this.startTimer(),this.initializeReveal()):alert("Please select an audience first")}loadPresentation(){if(!window.presentationData)return void console.error("Presentation data not loaded");const e=window.presentationData.templates[this.currentAudience];e?(this.currentPresentation=e,document.getElementById("currentTitle").textContent=e.title,document.querySelector(".total-slides").textContent=e.slides.length,this.generateSlides(),this.generateNavigator()):console.error("Template not found for audience:",this.currentAudience)}generateSlides(){const e=document.getElementById("dynamicSlides");e.innerHTML="",this.currentPresentation.slides.forEach((t,n)=>{const a=document.createElement("section");a.dataset.slideId=t.id,a.dataset.notes=t.notes||"",a.classList.add(`slide-${t.type}`),"title"===t.type&&a.classList.add("title-slide");let s=this.customizeContent(t.content),i=this.customizeContent(t.title),o=this.customizeContent(t.subtitle||""),r="";r="title"===t.type?`\n                    <img src="brand/logo.svg" alt="UIP" class="slide-logo">\n                    <h1 class="main-title">${i}</h1>\n                    ${o?`<p class="subtitle">${o}</p>`:""}\n                `:`\n                    <h2>${i}</h2>\n                    ${s}\n                `,a.innerHTML=r,e.appendChild(a)}),setTimeout(()=>this.initializeCharts(),100)}customizeContent(e){return e?e.replace(/\[Customer Name\]/g,this.customData.companyName||"[Customer Name]").replace(/\[Company\]/g,this.customData.companyName||"[Company]").replace(/\[Number\]/g,this.customData.vesselCount||"50").replace(/\[Annual Savings\]/g,this.customData.annualSavings||"700").replace(/\[Total Investment\]/g,this.customData.totalInvestment||"25").replace(/\[ROI Multiple\]/g,this.customData.roiMultiple||"28").replace(/\[Payback\]/g,this.customData.paybackDays||"13").replace(/\[Industry\]/g,this.customData.industryType||"General").replace(/\[Presenter Name\]/g,this.customData.presenterName||"UIP Team"):""}generateNavigator(){const e=document.getElementById("navigatorGrid");e.innerHTML="",this.currentPresentation.slides.forEach((t,n)=>{const a=document.createElement("div");a.classList.add("navigator-slide"),a.dataset.slideIndex=n,a.innerHTML=`\n                <div style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">\n                    ${n+1}. ${t.title}\n                </div>\n                <div style="font-size: 0.75rem; color: #64748B;">\n                    ${t.type.replace("-"," ").toUpperCase()}\n                </div>\n            `,a.addEventListener("click",()=>{this.goToSlide(n)}),e.appendChild(a)})}initializeReveal(){"undefined"!=typeof Reveal?(Reveal.initialize({hash:!0,controls:!0,progress:!0,center:!0,transition:"slide",backgroundTransition:"fade",plugins:[]}),Reveal.on("slidechanged",e=>{this.onSlideChanged(e.indexh)}),this.onSlideChanged(0)):console.error("Reveal.js not loaded")}initializeCharts(){if("undefined"==typeof Chart||!window.presentationData)return;const e=window.presentationData.charts,t=document.getElementById("tamChart");t&&new Chart(t,e.tam);const n=document.getElementById("financialsChart");n&&new Chart(n,e.financials);const a=document.getElementById("growthChart");a&&new Chart(a,e.growth);const s=document.getElementById("dashboardPreview");s&&this.createDashboardChart(s)}createDashboardChart(e){new Chart(e,{type:"doughnut",data:{labels:["Prevented D&D","Saved Hours","Won Disputes"],datasets:[{data:[23e5,1840,23],backgroundColor:["#00D4AA","#64748B","#0A1628"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(e){const t=e.label,n=e.parsed;return"Prevented D&D"===t?`${t}: $${(n/1e6).toFixed(1)}M`:"Saved Hours"===t?`${t}: ${n} hrs`:`${t}: ${n} disputes`}}}}}})}onSlideChanged(e){this.currentSlideIndex=e;const t=(e+1)/this.currentPresentation.slides.length*100;document.querySelector(".progress-fill").style.width=`${t}%`,document.querySelector(".current-slide").textContent=e+1,this.updateNotes(e),this.updateNavigator(e),this.animateSlideElements()}updateNotes(e){const t=this.currentPresentation.slides[e],n=document.getElementById("notesContent");t&&t.notes?n.innerHTML=`\n                <h4>Slide ${e+1}: ${t.title}</h4>\n                <p>${t.notes}</p>\n            `:n.innerHTML="No notes available for this slide."}updateNavigator(e){document.querySelectorAll(".navigator-slide").forEach((t,n)=>{t.classList.toggle("current",n===e)})}animateSlideElements(){const e=document.querySelector(".reveal .present");if(e){const t=e.querySelectorAll("h1, h2, h3, p, ul, .metric-card, .chart-container");anime({targets:t,opacity:[0,1],translateY:[20,0],duration:600,delay:anime.stagger(100),easing:"easeOutCubic"})}}goToSlide(e){"undefined"!=typeof Reveal&&Reveal.slide(e)}toggleNotes(){const e=document.getElementById("notesPanel");e.classList.toggle("active");document.getElementById("toggleNotes").textContent=e.classList.contains("active")?"Hide Notes":"Notes"}toggleFullscreen(){this.isFullscreen?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen(),this.isFullscreen=!this.isFullscreen,document.getElementById("toggleFullscreen").textContent=this.isFullscreen?"Exit Fullscreen":"Fullscreen"}startTimer(){this.timerStart=Date.now(),this.timerInterval=setInterval(()=>{const e=Date.now()-this.timerStart,t=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);document.getElementById("presentationTimer").textContent=`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}backToHub(){this.stopTimer(),document.getElementById("presentationViewer").style.display="none",document.getElementById("presentationHub").style.display="block",this.currentPresentation=null,this.currentSlideIndex=0,anime({targets:".presentation-hub",opacity:[0,1],translateY:[30,0],duration:600,easing:"easeOutCubic"})}previewSlides(){this.currentAudience?this.generatePreviewWindow():alert("Please select an audience first")}generatePreviewWindow(){const e=window.presentationData.templates[this.currentAudience];if(!e)return;const t=window.open("","_blank","width=800,height=600");let n=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>${e.title} - Preview</title>\n                <style>\n                    body { font-family: Inter, sans-serif; padding: 2rem; background: #F8FAFB; }\n                    .slide-preview { \n                        background: white; \n                        margin: 2rem 0; \n                        padding: 2rem; \n                        border-radius: 8px; \n                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n                    }\n                    .slide-number { \n                        background: #00D4AA; \n                        color: white; \n                        padding: 0.5rem 1rem; \n                        border-radius: 4px; \n                        font-weight: 600; \n                        display: inline-block; \n                        margin-bottom: 1rem; \n                    }\n                    h1, h2 { color: #0A1628; }\n                    .notes { \n                        background: #FFF8E1; \n                        padding: 1rem; \n                        border-radius: 4px; \n                        margin-top: 1rem; \n                        font-style: italic; \n                    }\n                </style>\n            </head>\n            <body>\n                <h1>${e.title}</h1>\n                <p><strong>Duration:</strong> ${e.duration} | <strong>Audience:</strong> ${e.audience}</p>\n        `;e.slides.forEach((e,t)=>{const a=this.customizeContent(e.title),s=this.customizeContent(e.content);n+=`\n                <div class="slide-preview">\n                    <div class="slide-number">Slide ${t+1}</div>\n                    <h2>${a}</h2>\n                    ${s}\n                    ${e.notes?`<div class="notes"><strong>Notes:</strong> ${e.notes}</div>`:""}\n                </div>\n            `}),n+="\n            </body>\n            </html>\n        ",t.document.write(n),t.document.close()}downloadPDF(){this.currentAudience?alert("PDF generation feature coming soon! Use your browser's print function to save as PDF."):alert("Please select an audience first")}handleKeyboard(e){if("none"!==document.getElementById("presentationViewer").style.display)switch(e.key){case"Escape":this.backToHub();break;case"f":case"F":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.toggleFullscreen());break;case"n":case"N":this.toggleNotes();break;case"ArrowRight":case"Space":"undefined"!=typeof Reveal&&Reveal.next();break;case"ArrowLeft":"undefined"!=typeof Reveal&&Reveal.prev()}}resizePresentation(){"undefined"!=typeof Reveal&&Reveal.layout()}saveCustomData(){localStorage.setItem("uip-presentation-data",JSON.stringify(this.customData))}loadSavedData(){const e=localStorage.getItem("uip-presentation-data");e&&(this.customData=JSON.parse(e),this.customData.companyName&&(document.getElementById("companyName").value=this.customData.companyName),this.customData.vesselCount&&(document.getElementById("vesselCount").value=this.customData.vesselCount),this.customData.industryType&&(document.getElementById("industryType").value=this.customData.industryType),this.customData.annualRevenue&&(document.getElementById("annualRevenue").value=this.customData.annualRevenue),this.customData.meetingDuration&&(document.getElementById("meetingDuration").value=this.customData.meetingDuration),this.customData.presenterName&&(document.getElementById("presenterName").value=this.customData.presenterName),this.updateROICalculations())}}document.addEventListener("DOMContentLoaded",()=>{window.presentationSuite=new PresentationSuite}),document.addEventListener("DOMContentLoaded",()=>{const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css",document.head.appendChild(e);const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.min.css",document.head.appendChild(t)});