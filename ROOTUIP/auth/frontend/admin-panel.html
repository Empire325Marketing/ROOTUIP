<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIP Enterprise Authentication - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 24px 32px;
            border-bottom: 1px solid #e2e8f0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .header-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-info {
            text-align: right;
        }
        
        .user-name {
            font-weight: 600;
        }
        
        .user-role {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 120px 20px 40px;
        }
        
        .admin-nav {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .nav-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            background: #f1f5f9;
            border: 2px solid transparent;
            color: #64748b;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }
        
        .nav-tab:hover {
            background: #e2e8f0;
        }
        
        .tab-content {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-icon {
            width: 24px;
            height: 24px;
            color: #3b82f6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1e40af;
            display: block;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
        }
        
        .data-table th,
        .data-table td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        .data-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.75rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            background: var(--bg-dark);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: #1e293b;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }
        
        .search-box {
            background: var(--bg-dark);
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 24px;
            width: 100%;
            max-width: 400px;
        }
        
        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px solid;
        }
        
        .alert-success {
            background: #dcfce7;
            color: #166534;
            border-color: #bbf7d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-color: #fecaca;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: var(--bg-dark);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background: #f3f4f6;
        }
        
        .pagination button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 120px 16px 40px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .data-table {
                font-size: 0.75rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 12px;
            }
        }
    </style>
<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ROOTUIP2025"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ROOTUIP2025');
</script>
    <link rel="stylesheet" href="/assets/css/rootuip-dark-theme.css">
</head>
<body>
    <div class="admin-header">
        <div class="header-content">
            <div class="header-title">UIP Enterprise Admin Panel</div>
            <div class="header-user">
                <div class="user-info">
                    <div class="user-name" id="userFullName">Loading...</div>
                    <div class="user-role" id="userRole">Loading...</div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="admin-container">
        <div class="admin-nav">
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="dashboard">
                    Dashboard
                </div>
                <div class="nav-tab" data-tab="users">
                    User Management
                </div>
                <div class="nav-tab" data-tab="roles">
                    Role Management
                </div>
                <div class="nav-tab" data-tab="security">
                    Security Settings
                </div>
                <div class="nav-tab" data-tab="audit">
                    Audit Logs
                </div>
                <div class="nav-tab" data-tab="api-keys">
                    API Keys
                </div>
                <div class="nav-tab" data-tab="settings">
                    Company Settings
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                System Overview
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="totalUsers">-</span>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="activeUsers">-</span>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalSessions">-</span>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="apiKeysCount">-</span>
                    <div class="stat-label">API Keys</div>
                </div>
            </div>

            <div class="section-title">Recent Activity</div>
            <table class="data-table" id="recentActivityTable">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Action</th>
                        <th>IP Address</th>
                        <th>Time</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" style="text-align: center; padding: 40px;">Loading...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- User Management Tab -->
        <div class="tab-content" id="users">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                </svg>
                User Management
            </div>

            <div class="actions-bar">
                <input type="text" class="search-box" placeholder="Search users..." id="userSearch">
                <button class="btn btn-primary" onclick="openCreateUserModal()">Create User</button>
            </div>

            <table class="data-table" id="usersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="6" style="text-align: center; padding: 40px;">Loading...</td></tr>
                </tbody>
            </table>

            <div class="pagination" id="usersPagination"></div>
        </div>

        <!-- Role Management Tab -->
        <div class="tab-content" id="roles">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
                Role Management
            </div>

            <div class="actions-bar">
                <input type="text" class="search-box" placeholder="Search roles..." id="roleSearch">
                <button class="btn btn-primary" onclick="openCreateRoleModal()">Create Role</button>
            </div>

            <table class="data-table" id="rolesTable">
                <thead>
                    <tr>
                        <th>Role Name</th>
                        <th>Description</th>
                        <th>Users</th>
                        <th>Permissions</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="6" style="text-align: center; padding: 40px;">Loading...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Security Settings Tab -->
        <div class="tab-content" id="security">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                Security Settings
            </div>

            <div style="display: grid; gap: 32px;">
                <div class="form-group">
                    <label class="form-label">Multi-Factor Authentication Policy</label>
                    <select class="form-select" id="mfaPolicy">
                        <option value="optional">Optional for all users</option>
                        <option value="required">Required for all users</option>
                        <option value="admin_only">Required for admins only</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Session Timeout (minutes)</label>
                    <input type="number" class="form-input" id="sessionTimeout" min="30" max="1440" value="480">
                </div>

                <div class="form-group">
                    <label class="form-label">Password Policy</label>
                    <div style="display: grid; gap: 16px; margin-top: 12px;">
                        <div>
                            <label class="form-label">Minimum Length</label>
                            <input type="number" class="form-input" id="passwordMinLength" min="8" max="64" value="12">
                        </div>
                        <div>
                            <input type="checkbox" id="requireUppercase" checked> Require uppercase letters
                        </div>
                        <div>
                            <input type="checkbox" id="requireLowercase" checked> Require lowercase letters
                        </div>
                        <div>
                            <input type="checkbox" id="requireNumbers" checked> Require numbers
                        </div>
                        <div>
                            <input type="checkbox" id="requireSymbols" checked> Require special characters
                        </div>
                        <div>
                            <label class="form-label">Password History Count</label>
                            <input type="number" class="form-input" id="passwordHistory" min="0" max="20" value="5">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveSecuritySettings()">Save Security Settings</button>
            </div>
        </div>

        <!-- Audit Logs Tab -->
        <div class="tab-content" id="audit">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                </svg>
                Audit Logs
            </div>

            <div class="actions-bar">
                <input type="text" class="search-box" placeholder="Search audit logs..." id="auditSearch">
                <div style="display: flex; gap: 12px;">
                    <select class="form-select" id="auditFilter" style="width: auto;">
                        <option value="">All Actions</option>
                        <option value="login">Login Events</option>
                        <option value="user">User Management</option>
                        <option value="role">Role Management</option>
                        <option value="api">API Operations</option>
                        <option value="security">Security Events</option>
                    </select>
                    <button class="btn btn-secondary" onclick="exportAuditLogs()">Export</button>
                </div>
            </div>

            <table class="data-table" id="auditTable">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>User</th>
                        <th>Action</th>
                        <th>Resource</th>
                        <th>IP Address</th>
                        <th>Status</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="7" style="text-align: center; padding: 40px;">Loading...</td></tr>
                </tbody>
            </table>

            <div class="pagination" id="auditPagination"></div>
        </div>

        <!-- API Keys Tab -->
        <div class="tab-content" id="api-keys">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                </svg>
                API Key Management
            </div>

            <div class="actions-bar">
                <input type="text" class="search-box" placeholder="Search API keys..." id="apiKeySearch">
                <button class="btn btn-primary" onclick="openCreateApiKeyModal()">Create API Key</button>
            </div>

            <table class="data-table" id="apiKeysTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Key Prefix</th>
                        <th>Owner</th>
                        <th>Permissions</th>
                        <th>Last Used</th>
                        <th>Expires</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" style="text-align: center; padding: 40px;">Loading...</td></tr>
                </tbody>
            </table>

            <div class="pagination" id="apiKeysPagination"></div>
        </div>

        <!-- Company Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Company Settings
            </div>

            <div style="display: grid; gap: 32px;">
                <div class="form-group">
                    <label class="form-label">Company Name</label>
                    <input type="text" class="form-input" id="companyName" placeholder="Enter company name">
                </div>

                <div class="form-group">
                    <label class="form-label">Domain</label>
                    <input type="text" class="form-input" id="companyDomain" placeholder="company.com">
                </div>

                <div class="form-group">
                    <label class="form-label">Maximum Users</label>
                    <input type="number" class="form-input" id="maxUsers" min="1" max="10000" value="100">
                </div>

                <div class="form-group">
                    <label class="form-label">White Label Settings</label>
                    <div style="margin-top: 12px;">
                        <input type="checkbox" id="whiteLabelEnabled"> Enable white-label branding
                    </div>
                    <div style="margin-top: 12px;">
                        <label class="form-label">Custom Domain</label>
                        <input type="text" class="form-input" id="customDomain" placeholder="auth.yourcompany.com">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Brand Colors</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;">
                        <div>
                            <label class="form-label">Primary Color</label>
                            <input type="color" class="form-input" id="primaryColor" value="#1e40af">
                        </div>
                        <div>
                            <label class="form-label">Secondary Color</label>
                            <input type="color" class="form-input" id="secondaryColor" value="#3b82f6">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveCompanySettings()">Save Company Settings</button>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-title" id="userModalTitle">Create User</div>
            <form id="userForm">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" class="form-input" id="userFirstName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" class="form-input" id="userLastName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="userRole" required>
                        <option value="">Select Role</option>
                    </select>
                </div>
                <div class="form-group" id="passwordGroup">
                    <label class="form-label">Temporary Password</label>
                    <input type="password" class="form-input" id="userPassword">
                    <small style="color: #6b7280;">User will be required to change password on first login</small>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveUser()">Save User</button>
            </div>
        </div>
    </div>

    <!-- Role Modal -->
    <div class="modal" id="roleModal">
        <div class="modal-content">
            <div class="modal-title" id="roleModalTitle">Create Role</div>
            <form id="roleForm">
                <div class="form-group">
                    <label class="form-label">Role Name</label>
                    <input type="text" class="form-input" id="roleName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="roleDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <div id="permissionsList" style="max-height: 300px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 8px; padding: 16px; margin-top: 8px;">
                        Loading permissions...
                    </div>
                </div>
            </form>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('roleModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveRole()">Save Role</button>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer" style="position: fixed; top: 100px; right: 20px; z-index: 3000; max-width: 400px;"></div>

    <script>
        // Global state
        let currentUser = null;
        let currentTab = 'dashboard';
        let users = [];
        let roles = [];
        let permissions = [];
        let apiKeys = [];
        let auditLogs = [];

        // Authentication and initialization
        async function init() {
            try {
                await loadCurrentUser();
                await loadInitialData();
                setupEventListeners();
            } catch (error) {
                console.error('Initialization error:', error);
                showAlert('Failed to initialize admin panel', 'error');
            }
        }

        async function loadCurrentUser() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/login';
                return;
            }

            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load user');
                }

                currentUser = await response.json();
                document.getElementById('userFullName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('userRole').textContent = currentUser.role;

                // Check admin permissions
                if (!currentUser.permissions.includes('system.admin') && 
                    !currentUser.permissions.includes('company.admin')) {
                    showAlert('Insufficient permissions to access admin panel', 'error');
                    setTimeout(() => window.location.href = '/dashboard', 3000);
                }
            } catch (error) {
                console.error('Failed to load user:', error);
                localStorage.removeItem('access_token');
                window.location.href = '/login';
            }
        }

        async function loadInitialData() {
            await Promise.all([
                loadDashboardStats(),
                loadUsers(),
                loadRoles(),
                loadPermissions(),
                loadApiKeys(),
                loadAuditLogs(),
                loadCompanySettings()
            ]);
        }

        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Search functionality
            document.getElementById('userSearch').addEventListener('input', debounce(filterUsers, 300));
            document.getElementById('roleSearch').addEventListener('input', debounce(filterRoles, 300));
            document.getElementById('auditSearch').addEventListener('input', debounce(filterAuditLogs, 300));
            document.getElementById('apiKeySearch').addEventListener('input', debounce(filterApiKeys, 300));

            // Filter functionality
            document.getElementById('auditFilter').addEventListener('change', filterAuditLogs);
        }

        function switchTab(tabName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabName);
            });

            currentTab = tabName;

            // Load tab-specific data if needed
            switch (tabName) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'audit':
                    loadAuditLogs();
                    break;
            }
        }

        // Dashboard functions
        async function loadDashboardStats() {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch('/api/admin/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                    document.getElementById('totalSessions').textContent = stats.activeSessions || 0;
                    document.getElementById('apiKeysCount').textContent = stats.apiKeys || 0;
                }

                // Load recent activity
                await loadRecentActivity();
            } catch (error) {
                console.error('Failed to load dashboard stats:', error);
            }
        }

        async function loadRecentActivity() {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch('/api/admin/recent-activity?limit=10', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const activity = await response.json();
                    renderRecentActivity(activity.logs || []);
                }
            } catch (error) {
                console.error('Failed to load recent activity:', error);
            }
        }

        function renderRecentActivity(logs) {
            const tbody = document.querySelector('#recentActivityTable tbody');
            
            if (logs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px;">No recent activity</td></tr>';
                return;
            }

            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>${log.user_name || 'System'}</td>
                    <td>${log.action}</td>
                    <td>${log.ip_address || '-'}</td>
                    <td>${new Date(log.created_at).toLocaleString()}</td>
                    <td>
                        <span class="status-badge ${log.success ? 'status-active' : 'status-inactive'}">
                            ${log.success ? 'Success' : 'Failed'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // User management functions
        async function loadUsers() {
            // Implementation would fetch users from API
            console.log('Loading users...');
        }

        function openCreateUserModal() {
            document.getElementById('userModalTitle').textContent = 'Create User';
            document.getElementById('userForm').reset();
            document.getElementById('passwordGroup').style.display = 'block';
            openModal('userModal');
        }

        // Role management functions
        async function loadRoles() {
            // Implementation would fetch roles from API
            console.log('Loading roles...');
        }

        async function loadPermissions() {
            // Implementation would fetch available permissions
            console.log('Loading permissions...');
        }

        function openCreateRoleModal() {
            document.getElementById('roleModalTitle').textContent = 'Create Role';
            document.getElementById('roleForm').reset();
            openModal('roleModal');
        }

        // API Key management functions
        async function loadApiKeys() {
            // Implementation would fetch API keys from API
            console.log('Loading API keys...');
        }

        function openCreateApiKeyModal() {
            // Implementation for API key creation modal
            console.log('Opening API key creation modal...');
        }

        // Audit log functions
        async function loadAuditLogs() {
            // Implementation would fetch audit logs from API
            console.log('Loading audit logs...');
        }

        function filterAuditLogs() {
            // Implementation for filtering audit logs
            console.log('Filtering audit logs...');
        }

        function exportAuditLogs() {
            // Implementation for exporting audit logs
            console.log('Exporting audit logs...');
        }

        // Company settings functions
        async function loadCompanySettings() {
            // Implementation would load company settings
            console.log('Loading company settings...');
        }

        async function saveCompanySettings() {
            // Implementation would save company settings
            showAlert('Company settings saved successfully', 'success');
        }

        async function saveSecuritySettings() {
            // Implementation would save security settings
            showAlert('Security settings saved successfully', 'success');
        }

        // Utility functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert_' + Date.now();
            
            const alert = document.createElement('div');
            alert.id = alertId;
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                ${message}
                <button onclick="document.getElementById('${alertId}').remove()" style="float: right; background: none; border: none; font-size: 1.2em; cursor: pointer;">&times;</button>
            `;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) alertElement.remove();
            }, 5000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function filterUsers() {
            // Implementation for filtering users
            console.log('Filtering users...');
        }

        function filterRoles() {
            // Implementation for filtering roles
            console.log('Filtering roles...');
        }

        function filterApiKeys() {
            // Implementation for filtering API keys
            console.log('Filtering API keys...');
        }

        async function saveUser() {
            // Implementation for saving user
            showAlert('User saved successfully', 'success');
            closeModal('userModal');
        }

        async function saveRole() {
            // Implementation for saving role
            showAlert('Role saved successfully', 'success');
            closeModal('roleModal');
        }

        async function logout() {
            try {
                const token = localStorage.getItem('access_token');
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                localStorage.removeItem('access_token');
                window.location.href = '/login';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
